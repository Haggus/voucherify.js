window.Voucherify=function(e,t,n){"use strict";function o(e,t){return Math.round(e*t)/t}var r={url:"https://voucherify-bouncer.herokuapp.com/client/v1/validate"},i=null;i=n&&"function"==typeof n.ajax&&n.Deferred?function(e,t){var o=null;return"function"!=typeof t&&(o=n.Deferred()),n.ajax({type:"GET",url:r.url+e,xhrFields:{withCredentials:!0},dataType:"json",headers:{"X-Client-Application-Id":r.applicationId,"X-Client-Token":r.token},timeout:r.timeout,success:function(e){var n=null;e&&"boolean"==typeof e.valid?"function"==typeof t?t(e):o.resolve(e):(n={type:"error",message:"Unexpected response structure.",context:e},"function"==typeof t?t(n):o.reject(n))},error:function(e){var n={type:"error",message:"XHR error happened.",context:e};"function"==typeof t?t(n):o.reject(n)}}),"function"!=typeof t?o.promise():void 0}:function(t,n){var o=new e.XMLHttpRequest;o.timeout=r.timeout,o.withCredentials=!0,o.open("GET",r.url+t,!0),o.setRequestHeader("X-Client-Application-Id",r.applicationId),o.setRequestHeader("X-Client-Token",r.token),o.onload=function(){var e=null;if(o.status>=200&&o.status<400){var t=JSON.parse(o.responseText);t&&"boolean"==typeof t.valid?"function"==typeof n&&n(t):(e={type:"error",message:"Unexpected response structure.",context:t},"function"==typeof n&&n(e))}else e={type:"error",message:"Unexpected status code.",context:o.status},"function"==typeof n&&n(e)},o.onerror=function(e){var t={type:"error",message:"XHR error happened.",context:e};"function"==typeof n&&n(t)},o.send()};var u={initialize:function(e,t,n){r.applicationId=e,r.token=t,r.timeout=n||5e3},setIdentity:function(e){r.trackingId=e},validate:function(e,t){if(!r.applicationId&&!r.token)return console.error("Voucherify client could not verify coupon - Lack of configuration - Missing Application ID or Token."),null;if(e&&(e=e.replace(/[\s\r\n]/g,"")),!e)return console.error("Voucherify client could not verify code, because it is missing - please provide Voucher Code."),null;var n="?code="+encodeURIComponent(e);return r.trackingId&&(n+="&tracking_id="+encodeURIComponent(r.trackingId)),i(n,t)},utils:{calculatePrice:function(e,t){var n=100,r=t.discount/n;if("PERCENT"===t.discount_type){if(!r||0>r||r>100)throw new Error("Invalid voucher, percent discount should be between 0-100.");var i=e*(r/100);return o(e-i,n)}if("AMOUNT"===t.discount_type){if(!r||0>r)throw new Error("Invalid voucher, amount discount must be higher than zero.");var u=e-r;return o(u>0?u:0,n)}throw new Error("Unsupported voucher type.")}}};return u}(window,window.document,window.jQuery);