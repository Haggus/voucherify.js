window.Voucherify=function(e,t,n){"use strict";function o(e){return Math.round(100.001*e)/100}function i(e){if(!e||0>e||e>100)throw new Error("Invalid voucher, percent discount should be between 0-100.")}function r(e){if(!e||0>e)throw new Error("Invalid voucher, amount discount must be higher than zero.")}function a(e){if(!e||0>e)throw new Error("Invalid voucher, unit discount must be higher than zero.")}var u={url:"https://voucherify-bouncer.herokuapp.com/client/v1/validate"},c=null;c=n&&"function"==typeof n.ajax&&n.Deferred?function(e,t){var o=null;return"function"!=typeof t&&(o=n.Deferred()),n.ajax({type:"GET",url:u.url+e,xhrFields:{withCredentials:!0},dataType:"json",headers:{"X-Client-Application-Id":u.applicationId,"X-Client-Token":u.token,"X-Voucherify-Channel":"Voucherify.js"},timeout:u.timeout,success:function(e){var n=null;e&&"boolean"==typeof e.valid?"function"==typeof t?t(e):o.resolve(e):(n={type:"error",message:"Unexpected response structure.",context:e},"function"==typeof t?t(n):o.reject(n))},error:function(e){var n={type:"error",message:"XHR error happened.",context:e};"function"==typeof t?t(n):o.reject(n)}}),"function"!=typeof t?o.promise():void 0}:function(t,n){var o=new e.XMLHttpRequest;o.timeout=u.timeout,o.withCredentials=!0,o.open("GET",u.url+t,!0),o.setRequestHeader("X-Client-Application-Id",u.applicationId),o.setRequestHeader("X-Client-Token",u.token),o.setRequestHeader("X-Voucherify-Channel","Voucherify.js"),o.onload=function(){var e=null;if(o.status>=200&&o.status<400){var t=JSON.parse(o.responseText);t&&"boolean"==typeof t.valid?"function"==typeof n&&n(t):(e={type:"error",message:"Unexpected response structure.",context:t},"function"==typeof n&&n(e))}else e={type:"error",message:"Unexpected status code.",context:o.status},"function"==typeof n&&n(e)},o.onerror=function(e){var t={type:"error",message:"XHR error happened.",context:e};"function"==typeof n&&n(t)},o.send()};var s={initialize:function(e,t,n){u.applicationId=e,u.token=t,u.timeout=n||5e3},setIdentity:function(e){u.trackingId=e},validate:function(e,t){if(!u.applicationId&&!u.token)return console.error("Voucherify client could not verify coupon - Lack of configuration - Missing Application ID or Token."),null;if(e&&(e=e.replace(/[\s\r\n]/g,"")),!e)return console.error("Voucherify client could not verify code, because it is missing - please provide Voucher Code."),null;var n="?code="+encodeURIComponent(e);return u.trackingId&&(n+="&tracking_id="+encodeURIComponent(u.trackingId)),c(n,t)},utils:{calculatePrice:function(e,t,n){var u,c=100;if("PERCENT"===t.discount.type){u=t.discount.percent_off,i(u);var s=e*(u/100);return o(e-s)}if("AMOUNT"===t.discount.type){u=t.discount.amount_off/c,r(u);var l=e-u;return o(l>0?l:0)}if("UNIT"===t.discount.type){u=t.discount.unit_off,a(u);var l=e-n*u;return o(l>0?l:0)}throw new Error("Unsupported voucher type.")},calculateDiscount:function(e,t,n){var u,c=100;if("PERCENT"===t.discount.type)return u=t.discount.percent_off,i(u),o(e*(u/100));if("AMOUNT"===t.discount.type){u=t.discount.amount_off/c,r(u);var s=e-u;return o(s>0?u:e)}if("UNIT"===t.discount.type){u=t.discount.unit_off,a(u);var l=n*u;return o(l>e?e:l)}throw new Error("Unsupported voucher type.")}},render:function(e,o){function i(e){return e.charAt(0).toUpperCase()+e.slice(1)}function r(e,t){return e+i(t)}function a(e,t){return o[r(e,t)]}function u(e,o,u,c){c=c||{};var s=null,l=a("selector",o);if(c.configurable&&l&&(s=n(l)),!s||!s.length){s=n(t.createElement(e)),u.append(s);for(var d in c)"configurable"!==d&&c.hasOwnProperty(d)&&s.attr(d,c[d]);"input"===e&&s.attr("name",i("name",o)||i("voucherify",o)),"span"===e&&c.text&&s.text(c.text)}return s.addClass("string"==typeof a("class",o)?a("class",o):r("voucherify",o)),s}var c=n(e);if(!c||!c.length)throw new Error("Element '"+e+"' cannot be found");o=o||{};var s=u("div","container",c),l=(u("img","logo",s,{src:"string"==typeof o.logoSrc?o.logoSrc:"https://app.voucherify.io/images/favicon.png"}),u("input","code",s,{type:"text",placeholder:"string"==typeof o.textPlaceholder?o.textPlaceholder:"e.g. abc-123"})),d=u("input","discountType",s,{type:"hidden",configurable:!0}),f=u("input","percentOff",s,{type:"hidden",configurable:!0}),p=u("input","amountOff",s,{type:"hidden",configurable:!0}),g=u("input","unitOff",s,{type:"hidden",configurable:!0}),v=u("input","tracking",s,{type:"hidden",configurable:!0}),y=u("button","validate",s,{}),h=(u("span","validateText",y,{text:"string"==typeof o.textValidate?o.textValidate:"Validate"}),this),m="string"===o.classInvalid?o.classInvalid:"voucherifyInvalid",C="string"==typeof o.classValid?o.classValid:"voucherifyValid",w="string"===o.classInvalidAnimation?o.classInvalidAnimation:"voucherifyAnimationShake",I="string"===o.classValidAnimation?o.classValidAnimation:"voucherifyAnimationTada";l.on("keyup",function(e){l.toggleClass(w,!1)}),y.on("click",function(e){return d.val(""),p.val(""),g.val(""),f.val(""),v.val(""),y.toggleClass(m,!1),y.toggleClass(C,!1),l.val()?void h.validate(l.val(),function(e){return e&&e.valid?(l.toggleClass(m,!1),d.val(e.discount&&e.discount.type||""),p.val(e.discount&&e.discount.amount_off||0),g.val(e.discount&&e.discount.unit_off||0),f.val(e.discount&&e.discount.percent_off||0),v.val(e.tracking_id||""),l.prop("disabled",!0),y.prop("disabled",!0),l.toggleClass(C,!0),y.toggleClass(C,!0),y.toggleClass(m,!1),l.toggleClass(m,!1),l.toggleClass(I,!0),void(o&&o.onValidated&&"function"==typeof o.onValidated&&o.onValidated(e))):(y.toggleClass(m,!0),y.toggleClass(C,!1),l.toggleClass(m,!0),l.toggleClass(C,!1),void l.toggleClass(w,!0).delay(1e3).queue(function(){l.toggleClass(w,!1),l.dequeue()}))}):void l.toggleClass(w,!0).delay(1e3).queue(function(){l.toggleClass(w,!1),l.dequeue()})})}};return s}(window,window.document,window.jQuery);