window.Voucherify=function(e,t,n){"use strict";function o(e){return Math.round(100.001*e)/100}function r(e){if(!e||0>e||e>100)throw new Error("Invalid voucher, percent discount should be between 0-100.")}function i(e){if(!e||0>e)throw new Error("Invalid voucher, amount discount must be higher than zero.")}function u(e){if(!e||0>e)throw new Error("Invalid voucher, unit discount must be higher than zero.")}var c={url:"https://voucherify-bouncer.herokuapp.com/client/v1/validate"},a=null;a=n&&"function"==typeof n.ajax&&n.Deferred?function(e,t){var o=null;return"function"!=typeof t&&(o=n.Deferred()),n.ajax({type:"GET",url:c.url+e,xhrFields:{withCredentials:!0},dataType:"json",headers:{"X-Client-Application-Id":c.applicationId,"X-Client-Token":c.token,"X-Voucherify-Channel":"Voucherify.js"},timeout:c.timeout,success:function(e){var n=null;e&&"boolean"==typeof e.valid?"function"==typeof t?t(e):o.resolve(e):(n={type:"error",message:"Unexpected response structure.",context:e},"function"==typeof t?t(n):o.reject(n))},error:function(e){var n={type:"error",message:"XHR error happened.",context:e};"function"==typeof t?t(n):o.reject(n)}}),"function"!=typeof t?o.promise():void 0}:function(t,n){var o=new e.XMLHttpRequest;o.timeout=c.timeout,o.withCredentials=!0,o.open("GET",c.url+t,!0),o.setRequestHeader("X-Client-Application-Id",c.applicationId),o.setRequestHeader("X-Client-Token",c.token),o.onload=function(){var e=null;if(o.status>=200&&o.status<400){var t=JSON.parse(o.responseText);t&&"boolean"==typeof t.valid?"function"==typeof n&&n(t):(e={type:"error",message:"Unexpected response structure.",context:t},"function"==typeof n&&n(e))}else e={type:"error",message:"Unexpected status code.",context:o.status},"function"==typeof n&&n(e)},o.onerror=function(e){var t={type:"error",message:"XHR error happened.",context:e};"function"==typeof n&&n(t)},o.send()};var s={initialize:function(e,t,n){c.applicationId=e,c.token=t,c.timeout=n||5e3},setIdentity:function(e){c.trackingId=e},validate:function(e,t){if(!c.applicationId&&!c.token)return console.error("Voucherify client could not verify coupon - Lack of configuration - Missing Application ID or Token."),null;if(e&&(e=e.replace(/[\s\r\n]/g,"")),!e)return console.error("Voucherify client could not verify code, because it is missing - please provide Voucher Code."),null;var n="?code="+encodeURIComponent(e);return c.trackingId&&(n+="&tracking_id="+encodeURIComponent(c.trackingId)),a(n,t)},utils:{calculatePrice:function(e,t,n){var c,a=100;if("PERCENT"===t.discount.type){c=t.discount.percent_off,r(c);var s=e*(c/100);return o(e-s)}if("AMOUNT"===t.discount.type){c=t.discount.amount_off/a,i(c);var f=e-c;return o(f>0?f:0)}if("UNIT"===t.discount.type){c=t.discount.unit_off,u(c);var f=e-n*c;return o(f>0?f:0)}throw new Error("Unsupported voucher type.")},calculateDiscount:function(e,t,n){var c,a=100;if("PERCENT"===t.discount.type)return c=t.discount.percent_off,r(c),o(e*(c/100));if("AMOUNT"===t.discount.type){c=t.discount.amount_off/a,i(c);var s=e-c;return o(s>0?c:e)}if("UNIT"===t.discount.type){c=t.discount.unit_off,u(c);var f=n*c;return o(f>e?e:f)}throw new Error("Unsupported voucher type.")}}};return s}(window,window.document,window.jQuery);