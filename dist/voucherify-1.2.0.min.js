window.Voucherify=function(e,t,n){"use strict";function o(e,t){return Math.round(e*(t+.001))/t}function r(e){if(!e||0>e||e>100)throw new Error("Invalid voucher, percent discount should be between 0-100.")}function i(e){if(!e||0>e)throw new Error("Invalid voucher, amount discount must be higher than zero.")}var u={url:"https://voucherify-bouncer.herokuapp.com/client/v1/validate"},c=null;c=n&&"function"==typeof n.ajax&&n.Deferred?function(e,t){var o=null;return"function"!=typeof t&&(o=n.Deferred()),n.ajax({type:"GET",url:u.url+e,xhrFields:{withCredentials:!0},dataType:"json",headers:{"X-Client-Application-Id":u.applicationId,"X-Client-Token":u.token},timeout:u.timeout,success:function(e){var n=null;e&&"boolean"==typeof e.valid?"function"==typeof t?t(e):o.resolve(e):(n={type:"error",message:"Unexpected response structure.",context:e},"function"==typeof t?t(n):o.reject(n))},error:function(e){var n={type:"error",message:"XHR error happened.",context:e};"function"==typeof t?t(n):o.reject(n)}}),"function"!=typeof t?o.promise():void 0}:function(t,n){var o=new e.XMLHttpRequest;o.timeout=u.timeout,o.withCredentials=!0,o.open("GET",u.url+t,!0),o.setRequestHeader("X-Client-Application-Id",u.applicationId),o.setRequestHeader("X-Client-Token",u.token),o.onload=function(){var e=null;if(o.status>=200&&o.status<400){var t=JSON.parse(o.responseText);t&&"boolean"==typeof t.valid?"function"==typeof n&&n(t):(e={type:"error",message:"Unexpected response structure.",context:t},"function"==typeof n&&n(e))}else e={type:"error",message:"Unexpected status code.",context:o.status},"function"==typeof n&&n(e)},o.onerror=function(e){var t={type:"error",message:"XHR error happened.",context:e};"function"==typeof n&&n(t)},o.send()};var a={initialize:function(e,t,n){u.applicationId=e,u.token=t,u.timeout=n||5e3},setIdentity:function(e){u.trackingId=e},validate:function(e,t){if(!u.applicationId&&!u.token)return console.error("Voucherify client could not verify coupon - Lack of configuration - Missing Application ID or Token."),null;if(e&&(e=e.replace(/[\s\r\n]/g,"")),!e)return console.error("Voucherify client could not verify code, because it is missing - please provide Voucher Code."),null;var n="?code="+encodeURIComponent(e);return u.trackingId&&(n+="&tracking_id="+encodeURIComponent(u.trackingId)),c(n,t)},utils:{calculatePrice:function(e,t){var n=100,u=t.discount/n;if("PERCENT"===t.discount_type){r(u);var c=e*(u/100);return o(e-c,n)}if("AMOUNT"===t.discount_type){i(u);var a=e-u;return o(a>0?a:0,n)}throw new Error("Unsupported voucher type.")},calculateDiscount:function(e,t){var n=100,u=t.discount/n;if("PERCENT"===t.discount_type)return r(u),o(e*(u/100),n);if("AMOUNT"===t.discount_type)return i(u),o(u,n);throw new Error("Unsupported voucher type.")}}};return a}(window,window.document,window.jQuery);